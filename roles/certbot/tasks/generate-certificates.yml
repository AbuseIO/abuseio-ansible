---
- name: Generate certificates for {{ abuseio_hostname }}
  shell: chdir={{ abuseio_basedir }}
    /opt/certbot/certbot-auto certonly -n -q --test-cert --agree-tos -m {{ abuseio_admin_contact }} --standalone --domains {{ abuseio_hostname }}

- name: Check if certificate exists.
  stat:
    path: /etc/letsencrypt/live/{{ abuseio_hostname }}/cert.pem
  register: letsencrypt_cert

- name: Stop if thre are no certificates present
  fail:
    msg: "A certificate should have been generated by certbot, however its not there."
  when: not letsencrypt_cert.stat.exists
